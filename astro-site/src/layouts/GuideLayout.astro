---
/**
 * GuideLayout - Layout for guide pages
 * Features: Table of Contents, Related Guides, Article Schema
 */
import BaseLayout from './BaseLayout.astro';
import Breadcrumb from '@/components/Breadcrumb.astro';
import SEO from '@/components/SEO.astro';

export interface Props {
  title: string;
  description: string;
  publishedDate?: string;
  updatedDate?: string;
  author?: string;
  category?: string;
  tags?: string[];
  relatedGuides?: Array<{
    title: string;
    slug: string;
    description: string;
  }>;
  toc?: boolean; // Show table of contents
}

const {
  title,
  description,
  publishedDate,
  updatedDate,
  author = 'AI GEO Team',
  category = 'Guide',
  tags = [],
  relatedGuides = [],
  toc = true,
} = Astro.props;

const breadcrumbItems = [
  { label: 'Home', href: '/' },
  { label: 'Guides', href: '/guides' },
  { label: title, href: Astro.url.pathname },
];

// Schema for Article
const articleSchema = {
  '@context': 'https://schema.org',
  '@type': 'Article',
  headline: title,
  description: description,
  url: new URL(Astro.url.pathname, Astro.site),
  datePublished: publishedDate || new Date().toISOString(),
  dateModified: updatedDate || publishedDate || new Date().toISOString(),
  author: {
    '@type': 'Organization',
    name: author,
  },
  publisher: {
    '@type': 'Organization',
    name: 'AI GEO',
    logo: {
      '@type': 'ImageObject',
      url: new URL('/images/logo.png', Astro.site),
    },
  },
  articleSection: category,
  keywords: tags.join(', '),
};
---

<BaseLayout title={title} description={description}>
  <SEO
    slot="head"
    title={title}
    description={description}
    type="article"
    article={{
      publishedTime: publishedDate,
      modifiedTime: updatedDate,
      author: author,
      section: category,
      tags: tags,
    }}
    schema={articleSchema}
  />

  <div class="container py-8">
    <Breadcrumb items={breadcrumbItems} />

    <div class="grid grid-cols-1 lg:grid-cols-12 gap-8 mt-8">
      <!-- Main Content -->
      <article class="lg:col-span-8 prose prose-invert max-w-none">
        <!-- Article Header -->
        <header class="mb-8 not-prose">
          <h1 class="text-4xl font-bold mb-4">{title}</h1>
          <p class="text-xl text-light mb-4">{description}</p>

          <div class="flex flex-wrap gap-4 text-sm text-light">
            {
              category && (
                <span class="px-3 py-1 rounded-full bg-dark-card border border-primary/30">
                  {category}
                </span>
              )
            }
            {
              publishedDate && (
                <span>
                  Published:{' '}
                  <time datetime={publishedDate}>
                    {new Date(publishedDate).toLocaleDateString('en-US', {
                      year: 'numeric',
                      month: 'long',
                      day: 'numeric',
                    })}
                  </time>
                </span>
              )
            }
            {
              updatedDate && (
                <span>
                  Updated:{' '}
                  <time datetime={updatedDate}>
                    {new Date(updatedDate).toLocaleDateString('en-US', {
                      year: 'numeric',
                      month: 'long',
                      day: 'numeric',
                    })}
                  </time>
                </span>
              )
            }
          </div>

          {
            tags.length > 0 && (
              <div class="flex flex-wrap gap-2 mt-4">
                {tags.map(tag => (
                  <span class="text-xs px-2 py-1 rounded bg-dark-bg border border-secondary/30 text-secondary">
                    #{tag}
                  </span>
                ))}
              </div>
            )
          }
        </header>

        <!-- Article Content -->
        <slot />
      </article>

      <!-- Sidebar -->
      <aside class="lg:col-span-4 space-y-8">
        <!-- Table of Contents -->
        {/* TODO: Implement TOC - requires headings from content */}
        {
          toc && (
            <div class="sticky top-20">
              <div class="p-6 rounded-lg bg-dark-card border border-primary/30">
                <h3 class="text-lg font-semibold mb-4">On This Page</h3>
                <p class="text-sm text-light">
                  Table of contents will be generated from page headings
                </p>
              </div>
            </div>
          )
        }

        <!-- Related Guides -->
        {
          relatedGuides.length > 0 && (
            <div class="p-6 rounded-lg bg-dark-card border border-primary/30">
              <h3 class="text-lg font-semibold mb-4">Related Guides</h3>
              <ul class="space-y-3">
                {relatedGuides.map(guide => (
                  <li>
                    <a
                      href={`/guides/${guide.slug}`}
                      class="block p-3 rounded hover:bg-dark-bg transition-colors group"
                    >
                      <h4 class="font-medium text-white group-hover:text-primary transition-colors">
                        {guide.title}
                      </h4>
                      <p class="text-sm text-light mt-1">{guide.description}</p>
                    </a>
                  </li>
                ))}
              </ul>
            </div>
          )
        }

        <!-- CTA Box -->
        <div
          class="p-6 rounded-lg bg-gradient-to-br from-primary/10 to-secondary/10 border border-primary/30"
        >
          <h3 class="text-lg font-semibold mb-2">Need Help?</h3>
          <p class="text-sm text-light mb-4">
            Get personalized optimization strategies for your content.
          </p>
          <a
            href="/contact"
            class="inline-block px-4 py-2 bg-primary text-white rounded hover:bg-primary/80 transition-colors"
          >
            Contact Us
          </a>
        </div>
      </aside>
    </div>
  </div>
</BaseLayout>
