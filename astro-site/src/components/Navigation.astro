---
// Navigation component with mega menus
export interface NavItem {
  label: string;
  href?: string;
  children?: NavItem[];
}

interface Props {
  currentPath?: string;
}

const { currentPath = '' } = Astro.props;

const platformsNav: NavItem[] = [
  {
    label: 'Major Chatbots',
    children: [
      { label: 'ChatGPT', href: '/platforms/chatgpt' },
      { label: 'Google Gemini', href: '/platforms/gemini' },
      { label: 'Claude', href: '/platforms/claude' },
      { label: 'Microsoft Copilot', href: '/platforms/copilot' },
      { label: 'Grok (X/Twitter)', href: '/platforms/grok' },
    ],
  },
  {
    label: 'Search Engines',
    children: [
      { label: 'Perplexity AI', href: '/platforms/perplexity' },
      { label: 'You.com', href: '/platforms/you-com' },
      { label: 'Google AI Overviews', href: '/platforms/google-ai-overviews' },
      { label: 'Meta AI', href: '/platforms/meta-ai' },
    ],
  },
  {
    label: 'Voice & Assistants',
    children: [
      { label: 'Voice Search Strategy', href: '/platforms/voice-search' },
      { label: 'Apple Siri', href: '/platforms/siri' },
      { label: 'Amazon Alexa', href: '/platforms/alexa' },
      { label: 'Google Assistant', href: '/platforms/google-assistant' },
    ],
  },
];

const guidesNav: NavItem[] = [
  {
    label: 'Strategy',
    children: [
      { label: 'Website Development Basics', href: '/guides/website-development-basics' },
      { label: 'Website Optimization', href: '/guides/website-optimization' },
      { label: 'Content Strategy', href: '/guides/content-strategy' },
      { label: 'E-E-A-T & Authority', href: '/guides/eeat-optimization' },
    ],
  },
  {
    label: 'Tactics',
    children: [
      { label: 'Social Media', href: '/guides/social-media-optimization' },
      { label: 'Local SEO for AI', href: '/guides/local-seo-ai' },
      { label: 'Analytics & Tracking', href: '/guides/analytics' },
      { label: 'Reputation Mgmt', href: '/guides/reputation-management' },
    ],
  },
  {
    label: 'Technical & Advanced',
    children: [
      { label: 'Technical SEO', href: '/guides/technical-seo' },
      { label: 'Schema Markup', href: '/guides/schema-markup' },
      { label: 'Writing for AI', href: '/guides/writing-for-ai' },
      { label: 'Agentic AI Opt', href: '/guides/agentic-ai-optimization' },
    ],
  },
];

const industriesNav: NavItem[] = [
  {
    label: 'Business Types',
    children: [
      { label: 'Local Business', href: '/industries/local-business' },
      { label: 'E-commerce & Retail', href: '/industries/ecommerce' },
      { label: 'B2B & Enterprise', href: '/industries/b2b' },
      { label: 'SaaS', href: '/industries/saas' },
    ],
  },
  {
    label: 'Sectors',
    children: [
      { label: 'Technology', href: '/industries/technology' },
      { label: 'Professional Services', href: '/industries/professional-services' },
      { label: 'Healthcare', href: '/industries/healthcare' },
      { label: 'Regulated Industries', href: '/industries/regulated' },
    ],
  },
  {
    label: 'Media',
    children: [
      { label: 'Content Creators', href: '/industries/content-creators' },
      { label: 'Publishing & Media', href: '/industries/publishing' },
    ],
  },
];

const resourcesNav: NavItem[] = [
  { label: 'Glossary', href: '/glossary' },
  { label: 'Industry Directory', href: '/resources/industry-directory' },
  { label: 'AI Visibility Scorecard (Beta)', href: '/tools/visibility-scorecard' },
  { label: 'Schema Validator (Beta)', href: '/tools/schema-validator' },
  { label: 'Content Checker (Beta)', href: '/tools/content-checker' },
  { label: 'Voice Search Analyzer (Beta)', href: '/tools/voice-search-analyzer' },
  { label: 'E-E-A-T Assessment (Beta)', href: '/tools/eeat-assessment' },
];
---

<nav class="navigation">
  <ul class="nav-links">
    <li><a href="/" class:list={['nav-link', { active: currentPath === '/' }]}>Home</a></li>

    <!-- AI Platforms Mega Menu -->
    <li class="dropdown has-mega-menu">
      <button class="dropdown-toggle nav-link" aria-haspopup="true" aria-expanded="false">
        AI Platforms <span class="dropdown-arrow">▼</span>
      </button>
      <div class="dropdown-menu mega-menu">
        <div class="mega-menu-header">
          <a href="/platforms/" class="mega-menu-cta">
            View All Platforms Directory →
          </a>
        </div>
        {
          platformsNav.map(section => (
            <div class="mega-menu-column">
              <span class="mega-menu-title">{section.label}</span>
              <ul>
                {section.children?.map(item => (
                  <li>
                    <a
                      href={item.href}
                      class:list={['mega-menu-link', { active: currentPath === item.href }]}
                    >
                      {item.label}
                    </a>
                  </li>
                ))}
              </ul>
            </div>
          ))
        }
      </div>
    </li>

    <!-- Guides Mega Menu -->
    <li class="dropdown has-mega-menu">
      <button class="dropdown-toggle nav-link" aria-haspopup="true" aria-expanded="false">
        Guides <span class="dropdown-arrow">▼</span>
      </button>
      <div class="dropdown-menu mega-menu">
        <div class="mega-menu-header">
          <a href="/guides/" class="mega-menu-cta">
            View All Guides Directory →
          </a>
        </div>
        {
          guidesNav.map(section => (
            <div class="mega-menu-column">
              <span class="mega-menu-title">{section.label}</span>
              <ul>
                {section.children?.map(item => (
                  <li>
                    <a
                      href={item.href}
                      class:list={['mega-menu-link', { active: currentPath === item.href }]}
                    >
                      {item.label}
                    </a>
                  </li>
                ))}
              </ul>
            </div>
          ))
        }
      </div>
    </li>

    <!-- Industries Mega Menu -->
    <li class="dropdown has-mega-menu">
      <button class="dropdown-toggle nav-link" aria-haspopup="true" aria-expanded="false">
        Industries <span class="dropdown-arrow">▼</span>
      </button>
      <div class="dropdown-menu mega-menu">
        <div class="mega-menu-header">
          <a href="/industries/" class="mega-menu-cta">
            View All Industries Directory →
          </a>
        </div>
        {
          industriesNav.map(section => (
            <div class="mega-menu-column">
              <span class="mega-menu-title">{section.label}</span>
              <ul>
                {section.children?.map(item => (
                  <li>
                    <a
                      href={item.href}
                      class:list={['mega-menu-link', { active: currentPath === item.href }]}
                    >
                      {item.label}
                    </a>
                  </li>
                ))}
              </ul>
            </div>
          ))
        }
      </div>
    </li>

    <!-- Resources Dropdown -->
    <li class="dropdown dropdown-right">
      <button class="dropdown-toggle nav-link" aria-haspopup="true" aria-expanded="false">
        Resources <span class="dropdown-arrow">▼</span>
      </button>
      <ul class="dropdown-menu">
        {
          resourcesNav.map(item => (
            <li>
              <a
                href={item.href}
                class:list={['dropdown-link', { active: currentPath === item.href }]}
              >
                {item.label}
              </a>
            </li>
          ))
        }
      </ul>
    </li>
  </ul>
</nav>

<script>
  // Dropdown functionality
  document.addEventListener('DOMContentLoaded', () => {
    const dropdowns = document.querySelectorAll('.dropdown');

    dropdowns.forEach(dropdown => {
      const toggle = dropdown.querySelector('.dropdown-toggle');
      const menu = dropdown.querySelector('.dropdown-menu');

      if (!toggle || !menu) return;

      toggle.addEventListener('click', e => {
        e.preventDefault();
        const isOpen = toggle.getAttribute('aria-expanded') === 'true';

        // Close all other dropdowns
        dropdowns.forEach(d => {
          const t = d.querySelector('.dropdown-toggle');
          const m = d.querySelector('.dropdown-menu');
          if (t && m && d !== dropdown) {
            t.setAttribute('aria-expanded', 'false');
            m.classList.remove('show');
          }
        });

        // Toggle current dropdown
        toggle.setAttribute('aria-expanded', String(!isOpen));
        menu.classList.toggle('show');
      });
    });

    // Close dropdowns when clicking outside
    document.addEventListener('click', e => {
      if (!(e.target as Element).closest('.dropdown')) {
        dropdowns.forEach(dropdown => {
          const toggle = dropdown.querySelector('.dropdown-toggle');
          const menu = dropdown.querySelector('.dropdown-menu');
          if (toggle && menu) {
            toggle.setAttribute('aria-expanded', 'false');
            menu.classList.remove('show');
          }
        });
      }
    });
  });
</script>

<style>
  .navigation {
    display: flex;
    align-items: center;
  }

  .nav-links {
    display: none;
    list-style: none;
    margin: 0;
    padding: 0;
    gap: 2rem;
  }

  @media (min-width: 768px) {
    .nav-links {
      display: flex;
    }
  }

  .nav-link {
    color: var(--text-light);
    text-decoration: none;
    font-size: 0.875rem;
    font-weight: 500;
    transition: color 0.2s;
    background: none;
    border: none;
    cursor: pointer;
    padding: 0;
  }

  .nav-link:hover,
  .nav-link.active {
    color: var(--primary);
  }

  .dropdown {
    position: relative;
  }

  .dropdown-toggle {
    display: flex;
    align-items: center;
    gap: 0.25rem;
  }

  .dropdown-arrow {
    font-size: 0.75rem;
    transition: transform 0.2s;
  }

  .dropdown-toggle[aria-expanded='true'] .dropdown-arrow {
    transform: rotate(180deg);
  }

  .dropdown-menu {
    display: none;
    position: absolute;
    top: 100%;
    left: 0;
    margin-top: 0.5rem;
    background: rgba(5, 10, 16, 0.95);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    border: 1px solid var(--border-color);
    border-radius: 0.5rem;
    box-shadow: 0 4px 6px -1px rgb(0 0 0 / 0.1);
    z-index: 50;
    min-width: 200px;
  }

  .dropdown-menu.show {
    display: block;
  }

  .dropdown-menu ul {
    list-style: none;
    margin: 0;
    padding: 0.5rem;
  }

  .dropdown-menu li {
    margin: 0;
  }

  .dropdown-link {
    display: block;
    padding: 0.5rem 0.75rem;
    color: var(--text-light);
    text-decoration: none;
    border-radius: 0.25rem;
    font-size: 0.875rem;
    transition: all 0.2s;
  }

  .dropdown-link:hover,
  .dropdown-link.active {
    background: var(--dark-bg);
    color: var(--primary);
  }

  /* Mega Menu */
  .mega-menu {
    display: none;
    min-width: 600px;
    padding: 1.5rem;
  }

  .mega-menu.show {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 2rem;
  }

  .mega-menu-column ul {
    padding: 0.5rem 0;
  }

  .mega-menu-title {
    display: block;
    font-weight: 600;
    color: var(--text-white);
    margin-bottom: 0.5rem;
    font-size: 0.875rem;
  }

  .mega-menu-link {
    display: block;
    padding: 0.375rem 0;
    color: var(--text-light);
    text-decoration: none;
    font-size: 0.875rem;
    transition: color 0.2s;
  }

  .mega-menu-link:hover,
  .mega-menu-link.active {
    color: var(--primary);
  }

  .mega-menu-header {
    grid-column: 1 / -1;
    margin-bottom: 1rem;
    padding-bottom: 1rem;
    border-bottom: 1px solid var(--border-color);
    text-align: center;
  }

  .mega-menu-cta {
    display: inline-block;
    padding: 0.5rem 1rem;
    background: var(--primary-color);
    color: white;
    text-decoration: none;
    border-radius: 0.375rem;
    font-size: 0.875rem;
    font-weight: 500;
    transition: all 0.2s;
  }

  .mega-menu-cta:hover {
    background: var(--primary-hover);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(var(--primary-rgb), 0.3);
  }

  .dropdown-right .dropdown-menu {
    left: auto;
    right: 0;
  }

  /* Light mode */
  html:not(.dark) .dropdown-menu {
    background: rgba(255, 255, 255, 0.95);
    backdrop-filter: blur(10px);
    -webkit-backdrop-filter: blur(10px);
    box-shadow: var(--shadow-lg);
  }

  html:not(.dark) .dropdown-link:hover,
  html:not(.dark) .dropdown-link.active {
    background: var(--bg-alt);
  }

  html:not(.dark) .mega-menu-title {
    color: var(--text-color);
  }
</style>
